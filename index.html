<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte Diario de Ventas en Campo - Telecable</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f9f7; }

    header { display: flex; align-items: center; margin-bottom: 20px; }
    header img { height: 120px; margin-right: 15px; }
    header h2 { 
      flex: 1; 
      background: #007BFF; 
      color: white; 
      padding: 15px; 
      border-radius: 8px; 
      margin: 0;
    }

    form { 
      background: #fff; 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.15); 
    }
    label { font-weight: bold; color: #004d40; }
    input, select, textarea { 
      width: 100%; 
      padding: 8px; 
      margin: 5px 0 15px; 
      border: 1px solid #ccc; 
      border-radius: 5px; 
    }

    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #e0f7fa; }

    .btn { 
      background-color: #007BFF; 
      color: white; 
      border: none; 
      padding: 10px; 
      border-radius: 8px; 
      cursor: pointer; 
      margin: 5px 0; 
      font-weight: bold;
      transition: transform 0.2s ease-in-out;
    }
    .btn:hover { background-color: #0056b3; }

    .btn.submit-btn {
      width: 100%;
      font-size: 16px;
      background: linear-gradient(135deg, #007BFF, #00c853);
      color: white;
      font-weight: bold;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    /* Animaci√≥n rebote */
    @keyframes bounce {
      0%   { transform: scale(1); }
      30%  { transform: scale(0.9); }
      50%  { transform: scale(1.05); }
      70%  { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    .bounce { animation: bounce 0.4s; }
  </style>
</head>
<body>

  <header>
    <img src="telecable.logo.png" alt="Telecable Logo">
    <h2>üìã Reporte Diario de Ventas en Campo</h2>
  </header>

  <form id="reporteForm" method="POST">

    <label for="dni">üÜî DNI de la Vendedora:</label>
    <input type="text" id="dni" name="dni" required>

    <label for="fecha">üìÖ Fecha:</label>
    <input type="date" id="fecha" name="fecha" required>

    <label for="turno">üïí Turno:</label>
    <select id="turno" name="turno" required>
      <option value="">Seleccione...</option>
      <option value="ma√±ana">Ma√±ana</option>
      <option value="tarde">Tarde</option>
    </select>

    <label for="ciudad">üèô Sede del Vendedor:</label>
    <select id="ciudad" name="ciudad" required>
      <option value="">Seleccione...</option>
      <option value="jauja">Jauja</option>
      <option value="huancayo_tambo">Huancayo - El Tambo</option>
      <option value="huancayo_sicaya">Huancayo - Sicaya</option>
      <option value="laoroya">La Oroya</option>
    </select>

    <label for="vendedor">üë§ Nombre del Vendedor(a):</label>
    <input type="text" id="vendedor" name="vendedor" required>

    <label for="zona">üìç Zona / Sector visitado:</label>
    <input type="text" id="zona" name="zona">

    <label for="nap">üîå Datos de la Caja NAP:</label>
    <input type="text" id="nap" name="nap" placeholder="Ejemplo: NAP-123 / Direcci√≥n de referencia">

    <h3>Clientes Visitados</h3>
    <table id="clientesTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Direcci√≥n / Referencia</th>
          <th>Tel√©fono / WhatsApp</th>
          <th>Servicio de Inter√©s</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody id="clientesBody"></tbody>
    </table>
    <button type="button" class="btn" onclick="agregarCliente()">‚ûï Agregar Cliente</button>

    <h3>Resultado del Turno</h3>
    <label for="comentarios">üìù Comentarios generales del turno:</label>
    <textarea id="comentarios" name="comentarios" rows="4"></textarea>

    <button type="submit" class="btn submit-btn">üì§ Enviar y Descargar</button>
  </form>

  <!-- Librer√≠a para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    let clienteCount = 0;

    function agregarCliente() {
      clienteCount++;
      const tbody = document.getElementById("clientesBody");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${clienteCount}</td>
        <td><input type="text" name="cliente_nombre${clienteCount}"></td>
        <td><input type="text" name="cliente_direccion${clienteCount}"></td>
        <td><input type="text" name="cliente_telefono${clienteCount}"></td>
        <td>
          <select name="cliente_servicio${clienteCount}" onchange="mostrarOtro(this, ${clienteCount})">
            <option value="">Seleccione...</option>
            <option value="duo">D√∫o Internet + TV Cable</option>
            <option value="internet">Solo Internet</option>
            <option value="cable">Solo Cable</option>
            <option value="otro">Otro</option>
          </select>
          <input type="text" id="otro${clienteCount}" name="cliente_otro${clienteCount}" placeholder="Especifique otro servicio" style="display:none;">
        </td>
        <td><input type="text" name="cliente_obs${clienteCount}"></td>
      `;
      tbody.appendChild(row);
    }

    function mostrarOtro(select, index) {
      const inputOtro = document.getElementById("otro" + index);
      inputOtro.style.display = (select.value === "otro") ? "block" : "none";
    }

    // --- Env√≠o a Google Sheets ---
    const form = document.getElementById("reporteForm");
    const enviarBtn = document.querySelector(".submit-btn");

    form.addEventListener("submit", e => {
      e.preventDefault();

      // Rebote visual
      enviarBtn.classList.add("bounce");
      setTimeout(() => enviarBtn.classList.remove("bounce"), 400);

      const formData = new FormData(form);

      fetch("https://script.google.com/macros/s/AKfycbzfGc9RG04wPqEIy7ZZcdq9NDTNKpwMFl-pSuo_ogvsi_Varf0ev8JOrHHRRumGvHAqhQ/exec", {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(result => {
        alert("‚úÖ Reporte enviado correctamente");
        descargarPDF();

        // Reset total
        form.reset();
        document.getElementById("clientesBody").innerHTML = "";
        clienteCount = 0;
      })
      .catch(error => {
        alert("‚ùå Error al enviar el reporte: " + error);
      });
    });

    // --- Generar PDF ---
    function descargarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text("Reporte Diario de Ventas - Telecable", 60, 20);

      doc.setFontSize(10);
      doc.text("DNI: " + document.getElementById("dni").value, 10, 50);
      doc.text("Fecha: " + document.getElementById("fecha").value, 10, 60);
      doc.text("Turno: " + document.getElementById("turno").value, 10, 70);
      doc.text("Sede: " + document.getElementById("ciudad").value, 10, 80);
      doc.text("Vendedor: " + document.getElementById("vendedor").value, 10, 90);
      doc.text("Zona: " + document.getElementById("zona").value, 10, 100);
      doc.text("NAP: " + document.getElementById("nap").value, 10, 110);

      let y = 130;
      for (let i = 1; i <= clienteCount; i++) {
        doc.text("Cliente " + i, 10, y);
        doc.text("Nombre: " + (document.querySelector(`[name=cliente_nombre${i}]`)?.value || ""), 20, y + 10);
        doc.text("Direcci√≥n: " + (document.querySelector(`[name=cliente_direccion${i}]`)?.value || ""), 20, y + 20);
        doc.text("Tel√©fono: " + (document.querySelector(`[name=cliente_telefono${i}]`)?.value || ""), 20, y + 30);
        doc.text("Servicio: " + (document.querySelector(`[name=cliente_servicio${i}]`)?.value || ""), 20, y + 40);
        doc.text("Obs: " + (document.querySelector(`[name=cliente_obs${i}]`)?.value || ""), 20, y + 50);
        y += 60;
      }

      doc.text("Comentarios: " + document.getElementById("comentarios").value, 10, y + 10);

      doc.save("Reporte_Telecable.pdf");
    }
  </script>
</body>
</html>
