<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reporte Diario de Ventas - Telecable</title>
<style>
:root{
  --blue-1:#007bff; --blue-2:#00c6ff; --green-1:#00c853;
  --accent-dark:#004d40; --bg:#f0f9f7; --card:#fff; --muted:#6b7280;
}
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
body{font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:#0f172a;}
.container{max-width:1100px; margin:18px auto; padding:0 16px;}
.topbar{display:flex; align-items:center; gap:16px; margin-bottom:16px;}
.logo{flex:0 0 auto; background:#fff; padding:10px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.12);}
.logo img{width:250px; height:auto;}
.header{flex:1 1 auto; background:linear-gradient(90deg,var(--blue-1),var(--blue-2)); color:#fff; padding:18px 20px; border-radius:12px; display:flex; align-items:center; justify-content:center; min-height:72px;}
.header h1{font-size:22px; margin:0; text-align:center; line-height:1.1;}
form{background:var(--card); padding:18px; border-radius:12px; box-shadow:0 8px 24px rgba(7,7,7,0.06);}
.grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
label{display:block; font-weight:600; color:var(--accent-dark); margin-bottom:6px; font-size:14px;}
input, select, textarea{width:100%; padding:12px; border-radius:8px; border:1px solid #d1d5db; font-size:16px; min-height:48px;}
input:focus, select:focus, textarea:focus{border-color:var(--blue-1); box-shadow:0 6px 14px rgba(0,123,255,0.08);}
textarea{min-height:110px; resize:vertical; font-size:15px;}
.btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:14px 16px; border-radius:10px; border:none; color:#fff; font-weight:700; cursor:pointer; font-size:16px; min-height:52px; transition:transform .18s ease, box-shadow .18s ease; box-shadow:0 4px 10px rgba(0,0,0,0.12);}
.btn:active{transform:translateY(1px);}
.btn.add{background:linear-gradient(90deg,var(--green-1),var(--blue-1));}
.btn.submit{width:100%; background:linear-gradient(135deg,var(--blue-1),var(--green-1)); font-size:17px;}
.actions-row{display:flex; gap:12px; align-items:center; margin-top:8px; flex-wrap:wrap;}
.small-note, .muted{font-size:13px; color:var(--muted);}
.bounce{animation:bounce 0.42s;}
@keyframes bounce{0%{transform:scale(1);}30%{transform:scale(0.9);}50%{transform:scale(1.05);}70%{transform:scale(0.95);}100%{transform:scale(1);}}
.clientes-wrapper{display:flex; flex-direction:column; gap:12px; margin-bottom:12px;}
.cliente-card{background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.06);}
.cliente-card label{font-size:13px; margin-top:6px;}
.cliente-card input, .cliente-card select{width:100%; min-height:44px; font-size:14px;}
@media(max-width:880px){.topbar{flex-direction:column; align-items:stretch; gap:12px;}.logo img{width:180px;}.header{border-radius:10px; padding:14px;}.header h1{font-size:20px;}.grid-2{grid-template-columns:1fr;}}
@media(max-width:420px){.logo img{width:150px;}.header h1{font-size:18px;}}
</style>
</head>
<body>
<div class="container">
  <div class="topbar">
    <div class="logo"><img src="telecable.logo.png" alt="Telecable Logo"></div>
    <div class="header"><h1>üìã Reporte Diario de Ventas en Campo</h1></div>
  </div>

  <form id="reporteForm" novalidate>
    <div class="grid-2">
      <div><label for="dni">üÜî DNI de la Vendedora</label><input id="dni" name="dni" required></div>
      <div><label for="fecha">üìÖ Fecha</label><input id="fecha" type="date" name="fecha" required></div>
    </div>
    <div class="grid-2">
      <div>
        <label for="turno">üïí Turno</label>
        <select id="turno" name="turno" required>
          <option value="">Seleccione...</option>
          <option>Ma√±ana</option><option>Tarde</option>
        </select>
      </div>
      <div>
        <label for="ciudad">üè¢ Sede del Vendedor</label>
        <select id="ciudad" name="ciudad" required>
          <option value="">Seleccione...</option>
          <option>Jauja</option>
          <option>Huancayo - El Tambo</option>
          <option>Huancayo - Sicaya</option>
          <option>La Oroya</option>
        </select>
      </div>
    </div>
    <div><label for="vendedor">üë§ Nombre del Vendedor(a)</label><input id="vendedor" name="vendedor" required></div>
    <div class="grid-2">
      <div><label for="zona">üìç Zona / Sector</label><input id="zona" name="zona"></div>
      <div><label for="nap">üîå Caja NAP</label><input id="nap" name="nap"></div>
    </div>

    <h3>Clientes Visitados</h3>
    <p class="small-note">No es obligatorio completar todo por cliente.</p>
    <div class="clientes-wrapper" id="clientesWrapper"></div>
    <div class="actions-row">
      <button type="button" class="btn add" id="addClienteBtn">‚ûï Agregar Cliente</button>
      <span class="muted">A√±ade cuantos clientes necesites</span>
    </div>

    <h3>Resultado del Turno</h3>
    <label for="comentarios">üìù Comentarios generales</label>
    <textarea id="comentarios" name="comentarios"></textarea>

    <button type="submit" class="btn submit" id="submitBtn">üì§ Enviar y Descargar</button>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyQQxLlqklVvNbLScS86n4Ll85HTWLtZOS-bJ3pHYf24HNvfZviXezSwMIyaBa1xzoofw/exec";

let clienteCount=0;
const wrapper=document.getElementById("clientesWrapper");
const form=document.getElementById("reporteForm");

document.getElementById("addClienteBtn").addEventListener("click", ()=>{
  clienteCount++;
  const card=document.createElement("div");
  card.classList.add("cliente-card");
  card.innerHTML=`
    <label>Cliente #${clienteCount}</label>
    <div><label>Nombre</label><input data-key="nombre"></div>
    <div><label>Direcci√≥n</label><input data-key="direccion"></div>
    <div><label>Tel√©fono</label><input data-key="telefono"></div>
    <div><label>Servicio</label>
      <select data-key="servicio">
        <option value="">Seleccione...</option>
        <option>D√∫o Internet + TV</option>
        <option>Solo Internet</option>
        <option>Solo Cable</option>
        <option>Otro</option>
      </select>
    </div>
    <div><label>Observaciones</label><input data-key="obs"></div>
  `;
  wrapper.appendChild(card);
  card.scrollIntoView({behavior:'smooth'});
});

// Funci√≥n para crear inputs ocultos para clientes
function agregarClienteInputsHidden() {
  document.querySelectorAll('.cliente-hidden').forEach(el=>el.remove());
  document.querySelectorAll(".cliente-card").forEach((c,i)=>{
    const campos = c.querySelectorAll("[data-key]");
    campos.forEach(campo=>{
      const input = document.createElement("input");
      input.type="hidden";
      input.name = `clientes[${i}][${campo.dataset.key}]`;
      input.value = campo.value;
      input.classList.add("cliente-hidden");
      form.appendChild(input);
    });
  });
}

document.getElementById("reporteForm").addEventListener("submit", async e=>{
  e.preventDefault();

  if(!document.getElementById("dni").value.trim()||
     !document.getElementById("fecha").value||
     !document.getElementById("turno").value||
     !document.getElementById("ciudad").value||
     !document.getElementById("vendedor").value.trim()){
    alert("Por favor completa los datos del vendedor.");
    return;
  }

  document.getElementById("submitBtn").classList.add("bounce");
  setTimeout(()=>document.getElementById("submitBtn").classList.remove("bounce"),420);

  agregarClienteInputsHidden(); // agrega clientes al form

  const formData = new FormData(form);
  try{
    await fetch(GOOGLE_SCRIPT_URL, { method:"POST", body: formData });
    alert("Datos enviados correctamente al servidor.");
  }catch(err){
    console.error(err);
    alert("Error enviando datos al servidor.");
  }

  // Descargar PDF
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  let y=20;
  doc.setFontSize(14);
  doc.text("Reporte Diario de Ventas - Telecable",10,y);
  y+=10;
  doc.setFontSize(10);
  const data = Object.fromEntries(formData);
  doc.text(`DNI: ${data.dni}`,10,y+=10);
  doc.text(`Fecha: ${data.fecha}`,100,y);
  doc.text(`Turno: ${data.turno}`,10,y+=10);
  doc.text(`Sede: ${data.ciudad}`,100,y);
  doc.text(`Vendedor: ${data.vendedor}`,10,y+=10);
  doc.text(`Zona: ${data.zona}`,100,y);
  doc.text(`NAP: ${data.nap}`,10,y+=10);
  doc.text("Comentarios:",10,y+=10);
  doc.text(data.comentarios||"-",10,y+=10);
  y+=10;
  if(clienteCount>0){
    doc.text("Clientes:",10,y);
    let index=0;
    while(formData.has(`clientes[${index}][nombre]`)){
      const cNombre = formData.get(`clientes[${index}][nombre]`);
      const cDireccion = formData.get(`clientes[${index}][direccion]`);
      const cTelefono = formData.get(`clientes[${index}][telefono]`);
      const cServicio = formData.get(`clientes[${index}][servicio]`);
      const cObs = formData.get(`clientes[${index}][obs]`);
      y+=6;
      doc.text(`${index+1}. ${cNombre} | ${cDireccion} | ${cTelefono} | ${cServicio} | ${cObs}`,10,y);
      index++;
    }
  }

  form.reset();
  wrapper.innerHTML='';
  clienteCount=0;
});
</script>
</body>
</html>


